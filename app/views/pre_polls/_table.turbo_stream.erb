<table id="proposal_result" class="table">
<% max_col = pre_poll.proposals.size
   max_col = 0 unless max_col
   max_row = pre_poll.proposals.map { |proposal| proposal.choiceitems.size }.max
   max_row = 0 unless max_row
   
   initial_value = ["", false]
   array = Array(size: max_row, val: initial_value)
   
   0.upto(max_row - 1) do |count|
     array[count] = Array(max_col)
   end
   pre_poll.proposals.default_order.each_with_index do |proposal, ind_c|
     proposal.choiceitems.default_order.each_with_index do |choiceitem, ind_r|
       array[ind_r][ind_c] = [choiceitem.title, choiceitem.accepted]
     end
   end %>

<tr> <% pre_poll.proposals.default_order.each_with_index do |proposal, ind_c| %>
    <th> <%= link_to proposal.user_name,
                     edit_pre_poll_proposal_path(pre_poll, proposal),
                     data: { turbo_frame: "proposal_form" } %></th>
    <% end %>
</tr>

<% 0.upto(max_row - 1) do |row_index| %>
<tr>
        <% 0.upto(max_col - 1) do |col_index| %>
          <% item = array[row_index][col_index] %>
          <% # raise if item[0].instance_of?(Integer)
             
             itemx = if item.nil? || item[1].nil?
                 initial_value
               else
                 item
               end
             # raise if itemx[0].instance_of?(Integer) %>
          <% if itemx[1] %>
            <td class="accepted"><%= itemx[0] %></td>
          <% else %>
            <td><%= itemx[0] %></td>
          <% end %>
        <% end %>
</tr>
      <% end %>

</table>

